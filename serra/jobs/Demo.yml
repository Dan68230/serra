read:
  class_name: DatabricksReader
  config:
    database: 'demo'
    table: 'restaurants'

join_restaurant_ratings:
  class_name: JoinTransformer
  config:
    input_block: read
    join_type: 'inner'
    matching_col: ['id','id']
    path: 's3a://serrademo/rating_df.csv' 

map_state_names:
  class_name: MapTransformer
  config:
    input_block: join_restaurant_ratings
    name: 'region_abbr'
    map_dict:
        Alabama: 'AL'
        Alaska: 'AK'
        Arizona: 'AZ'
        Arkansas: 'AR'
        California: 'CA'
        Colorado: 'CO'
        Connecticut: 'CT'
        Delaware: 'DE'
        Florida: 'FL'
        Georgia: 'GA'
        Hawaii: 'HI'
        Idaho: 'ID'
        Illinois: 'IL'
        Indiana: 'IN'
        Iowa: 'IA'
        Kansas: 'KS'
        Kentucky: 'KY'
        Louisiana: 'LA'
        Maine: 'ME'
        Maryland: 'MD'
        Massachusetts: 'MA'
        Michigan: 'MI'
        Minnesota: 'MN'
        Mississippi: 'MS'
        Missouri: 'MO'
        Montana: 'MT'
        Nebraska: 'NE'
        Nevada: 'NV'
        New Hampshire: 'NH'
        New Jersey: 'NJ'
        New Mexico: 'NM'
        New York: 'NY'
        North Carolina: 'NC'
        North Dakota: 'ND'
        Ohio: 'OH'
        Oklahoma: 'OK'
        Oregon: 'OR'
        Pennsylvania: 'PA'
        Rhode Island: 'RI'
        South Carolina: 'SC'
        South Dakota: 'SD'
        Tennessee: 'TN'
        Texas: 'TX'
        Utah: 'UT'
        Vermont: 'VT'
        Virginia: 'VA'
        Washington: 'WA'
        West Virginia: 'WV'
        Wisconsin: 'WI'
        Wyoming: 'WY'
    col_key: 'region'
  
cast_ratings:
  class_name: CastColumnTransformer
  config:
    input_block: 'map_state_names'
    cast_columns:
      rating: ['rating', 'double']

pivot_region_ratings:
  class_name: PivotTransformer
  config:
    input_block: cast_ratings
    row_level: 'restaurant'
    column_level: 'region_abbr'
    sum_col: 'rating'

write:
  class_name: DatabricksWriter
  config:
    input_block: 'pivot_region_ratings'
    database: 'demo'
    table: 'sales_by_store'
    format: 'delta'
    mode: 'overwrite'
